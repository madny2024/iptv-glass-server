<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - IPTV Glass</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { 
            --bg: #050507; 
            --neon: #00f3ff; 
            --neon-glow: rgba(0, 243, 255, 0.4); 
            --text: #fff; 
            --nav-width: 80px; 
        }
        
        * { box-sizing: border-box; outline: none; margin: 0; padding: 0; }
        
        body { 
            background: var(--bg); 
            background-image: radial-gradient(circle at 50% 0%, #1a1a2e 0%, #050507 60%); 
            color: var(--text); 
            font-family: 'Inter', sans-serif; 
            height: 100vh; 
            display: flex; 
            overflow: hidden; 
        }
        
        /* NAV RAIL */
        .nav-rail { 
            width: var(--nav-width); height: 100vh; 
            background: rgba(10, 10, 12, 0.8); 
            backdrop-filter: blur(20px); 
            border-right: 1px solid rgba(255,255,255,0.08); 
            display: flex; flex-direction: column; align-items: center; 
            padding: 30px 0; z-index: 100; flex-shrink: 0; 
        }
        
        .brand-icon { 
            width: 40px; height: 40px; margin-bottom: 50px; 
            color: var(--neon); 
            filter: drop-shadow(0 0 10px var(--neon-glow)); 
            cursor: pointer; 
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        .brand-icon:hover { transform: scale(1.1) rotate(-10deg); }
        
        .nav-menu { 
            display: flex; flex-direction: column; gap: 30px; 
            flex: 1; width: 100%; align-items: center; 
        }
        
        .nav-item { 
            color: #8b9bb4; font-size: 1.4rem; cursor: pointer; 
            transition: all 0.2s; width: 50px; height: 50px; 
            display: flex; align-items: center; justify-content: center; 
            border-radius: 12px; text-decoration: none; position: relative; 
        }
        .nav-item:hover { color: #fff; background: rgba(255,255,255,0.05); }
        .nav-item.active { 
            color: var(--neon); 
            background: rgba(255,255,255,0.05); 
            box-shadow: inset 3px 0 0 0 var(--neon); 
        }
        
        .user-profile { 
            width: 45px; height: 45px; border-radius: 50%; 
            background: linear-gradient(45deg, #333, #111); 
            border: 2px solid rgba(255,255,255,0.1); 
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer; overflow: hidden; margin-bottom: 20px; 
        }
        
        /* MAIN CONTENT */
        .main-wrapper { 
            flex: 1; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; 
            height: 100vh; overflow-y: auto; position: relative; 
        }
        
        .hub-content { 
            text-align: center; 
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        
        .logo-big { 
            font-size: 3rem; font-weight: 800; 
            margin-bottom: 50px; letter-spacing: -2px; 
        } 
        .logo-big span { 
            color: var(--neon); 
            text-shadow: 0 0 30px rgba(0, 243, 255, 0.5); 
        }
        
        .menu-grid { 
            display: flex; gap: 30px; flex-wrap: wrap; 
            justify-content: center; 
        }
        
        .card { 
            width: 240px; height: 340px; 
            background: linear-gradient(145deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); 
            border: 1px solid rgba(255,255,255,0.08); 
            border-radius: 24px; 
            display: flex; flex-direction: column; 
            align-items: center; justify-content: center; 
            cursor: pointer; 
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), border-color 0.3s; 
            text-decoration: none; position: relative; overflow: hidden; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
        }
        .card:hover { 
            transform: translateY(-15px) scale(1.02); 
            border-color: var(--border-color); 
        }
        
        .icon { 
            font-size: 4rem; margin-bottom: 25px; 
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3)); 
            transition: transform 0.3s, filter 0.3s; 
        }
        .card:hover .icon { 
            transform: scale(1.1); 
            filter: drop-shadow(0 0 20px var(--glow-color)); 
        }
        
        .title { 
            font-size: 1.2rem; font-weight: 800; 
            text-transform: uppercase; margin-bottom: 8px; 
            color: var(--title-color); letter-spacing: 1px; 
        }
        
        .subtitle { 
            font-size: 0.8rem; color: #888; 
            text-align: center; max-width: 80%; line-height: 1.4; 
        }
        
        .card-live { --glow-color: #00f3ff; --border-color: #00f3ff; --title-color: #00f3ff; }
        .card-movie { --glow-color: #bc13fe; --border-color: #bc13fe; --title-color: #bc13fe; }
        .card-series { --glow-color: #ff2a6d; --border-color: #ff2a6d; --title-color: #ff2a6d; }

        /* PAINEL DE CONEX√ÉO */
        .connection-panel {
            position: absolute; top: 30px; right: 30px;
            background: rgba(20, 20, 28, 0.9); 
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px; padding: 25px 30px;
            min-width: 320px; box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            z-index: 50;
        }

        .panel-header {
            display: flex; align-items: center; gap: 12px;
            margin-bottom: 20px; padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .panel-header i { font-size: 1.5rem; color: var(--neon); }
        .panel-title { 
            font-size: 1rem; font-weight: 800; 
            text-transform: uppercase; letter-spacing: 1px; 
        }

        .status-row {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .status-label { 
            font-size: 0.75rem; color: #888; 
            text-transform: uppercase; letter-spacing: 1px; 
        }
        .status-value { 
            display: flex; align-items: center; gap: 8px; 
            font-weight: 700; font-size: 0.85rem; 
        }
        .status-dot { 
            width: 8px; height: 8px; border-radius: 50%; 
            background: #ff2a6d; transition: 0.3s; 
        }
        .status-dot.active { 
            background: var(--neon); 
            box-shadow: 0 0 10px var(--neon); 
            animation: pulse 2s infinite; 
        }

        @keyframes pulse { 
            0%, 100% { opacity: 1; } 
            50% { opacity: 0.5; } 
        }

        .code-display {
            background: rgba(0,0,0,0.4); 
            border: 2px dashed rgba(0, 243, 255, 0.3);
            border-radius: 12px; padding: 20px;
            text-align: center; margin: 20px 0;
        }
        .code-number {
            font-size: 2.5rem; font-weight: 900; 
            font-family: monospace; letter-spacing: 8px;
            color: var(--neon); text-shadow: 0 0 20px var(--neon-glow);
        }
        .code-label {
            font-size: 0.7rem; color: #666; 
            text-transform: uppercase; letter-spacing: 2px;
            margin-top: 8px;
        }

        .btn-generate {
            width: 100%; background: var(--neon); color: #000;
            border: none; padding: 14px; border-radius: 10px;
            font-weight: 800; font-size: 0.9rem; cursor: pointer;
            text-transform: uppercase; letter-spacing: 1px;
            transition: all 0.2s; box-shadow: 0 5px 20px rgba(0, 243, 255, 0.3);
        }
        .btn-generate:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 8px 30px rgba(0, 243, 255, 0.5); 
        }
        .btn-generate:active { transform: translateY(0); }

        .help-text {
            font-size: 0.75rem; color: #666; 
            line-height: 1.6; margin-top: 15px;
            text-align: center;
        }
        .help-text i { color: var(--neon); margin-right: 5px; }
    </style>
</head>
<body>

    <nav class="nav-rail">
        <div class="brand-icon" onclick="location.reload()">
            <svg viewBox="0 0 24 24" fill="currentColor" width="100%" height="100%">
                <path d="M17,11H16.89l-0.78-4.66C15.93,5.18,14.99,4.42,13.88,4.56c-0.28,0.03-0.56,0.11-0.81,0.24 c-0.27-0.12-0.56-0.18-0.86-0.19C11.1,4.48,10.15,5.24,9.97,6.34L9.11,11H9c-1.1,0-2,0.9-2,2v7c0,1.1,0.9,2,2,2h8c1.1,0,2-0.9,2-2 v-7C19,11.9,18.1,11,17,11z M6.98,9.08c0.35-0.08,0.7,0.13,0.79,0.48L8.06,11H7.29L6.5,9.88C6.55,9.52,6.73,9.15,6.98,9.08z M12.56,5.33c0.41,0.27,0.52,0.83,0.25,1.24L12,7.79l-0.75-1.22C10.99,6.16,11.1,5.6,11.52,5.33 C11.83,5.13,12.24,5.13,12.56,5.33z M14.88,5.48c0.44,0.19,0.64,0.71,0.45,1.15L15,7.45l-1.39-0.45C13.43,6.56,13.23,6.04,13.42,5.6 C13.68,5.01,14.28,4.9,14.88,5.48z M16.49,9.08c0.26,0.06,0.44,0.44,0.49,0.79L16.2,11h-0.78L16,9.57C16.1,9.21,16.45,9,16.49,9.08z M17,20H9v-7h8V20z"/>
            </svg>
        </div>
        <div class="nav-menu">
            <a href="home.html" class="nav-item active"><i class="fa-solid fa-layer-group"></i></a>
            <a href="browse.html?type=live" class="nav-item"><i class="fa-solid fa-tv"></i></a>
            <a href="browse.html?type=movie" class="nav-item"><i class="fa-solid fa-film"></i></a>
            <a href="browse.html?type=series" class="nav-item"><i class="fa-solid fa-clapperboard"></i></a>
        </div>
        <div class="user-profile" onclick="if(confirm('Sair?')) location.href='index.html'">
            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" style="width:100%;" loading="lazy">
        </div>
    </nav>

    <div class="main-wrapper">
        <!-- PAINEL DE CONEX√ÉO -->
        <div class="connection-panel">
            <div class="panel-header">
                <i class="fa-solid fa-mobile-screen"></i>
                <span class="panel-title">Conectar App</span>
            </div>

            <div class="status-row">
                <span class="status-label">Servidor</span>
                <div class="status-value">
                    <div id="serverDot" class="status-dot"></div>
                    <span id="serverStatus">Conectando...</span>
                </div>
            </div>

            <div class="status-row">
                <span class="status-label">Dispositivos</span>
                <div class="status-value">
                    <span id="deviceCount">0</span>
                    <i class="fa-solid fa-users" style="color: #666; font-size: 0.9rem;"></i>
                </div>
            </div>

            <div class="code-display">
                <div id="codeNumber" class="code-number">-----</div>
                <div class="code-label">C√ìDIGO DE PAREAMENTO</div>
            </div>

            <button class="btn-generate" onclick="generateNewCode()">
                <i class="fa-solid fa-rotate-right"></i> GERAR NOVO C√ìDIGO
            </button>

            <div class="help-text">
                <i class="fa-solid fa-circle-info"></i>
                Abra o app no celular e digite este c√≥digo para conectar
            </div>
        </div>

        <!-- CARDS DE NAVEGA√á√ÉO -->
        <div class="hub-content">
            <div class="logo-big">IPTV <span>GLASS</span></div>
            <div class="menu-grid">
                <a href="browse.html?type=live" class="card card-live">
                    <div class="icon">üì∫</div>
                    <div class="title">TV Ao Vivo</div>
                    <div class="subtitle">Canais e Esportes</div>
                </a>
                <a href="browse.html?type=movie" class="card card-movie">
                    <div class="icon">üé¨</div>
                    <div class="title">Filmes</div>
                    <div class="subtitle">Cinema on Demand</div>
                </a>
                <a href="browse.html?type=series" class="card card-series">
                    <div class="icon">üçø</div>
                    <div class="title">S√©ries</div>
                    <div class="subtitle">Temporadas Completas</div>
                </a>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        const BASE_URL = window.location.origin;
        let socket;
        let currentRoom = null;
        let connectionAttempts = 0;
        const MAX_ATTEMPTS = 5;

        // Elementos DOM
        const elements = {
            serverDot: document.getElementById('serverDot'),
            serverStatus: document.getElementById('serverStatus'),
            deviceCount: document.getElementById('deviceCount'),
            codeNumber: document.getElementById('codeNumber')
        };

        // INICIALIZA√á√ÉO
        function init() {
            // Tenta restaurar sala anterior
            currentRoom = localStorage.getItem('pairing_code');
            
            if (currentRoom) {
                elements.codeNumber.textContent = currentRoom;
            } else {
                generateNewCode();
            }

            // Conecta ao servidor
            connectToServer();
        }

        // CONEX√ÉO COM SERVIDOR
        function connectToServer() {
            try {
                socket = io(window.location.origin, {
                    transports: ['websocket', 'polling'],
                    reconnection: true,
                    reconnectionDelay: 1000,
                    reconnectionAttempts: MAX_ATTEMPTS
                });

                setupSocketListeners();
            } catch (error) {
                console.error('[SOCKET ERROR]', error);
                updateServerStatus(false, 'Erro de Conex√£o');
            }
        }

        // LISTENERS DO SOCKET
        function setupSocketListeners() {
            // Conectado
            socket.on('connect', () => {
                console.log('‚úÖ Conectado ao servidor');
                connectionAttempts = 0;
                updateServerStatus(true, 'Online');
                
                // Entra na sala automaticamente
                if (currentRoom) {
                    socket.emit('join_room', {
                        room: currentRoom,
                        type: 'web'
                    });
                }
            });

            // Desconectado
            socket.on('disconnect', (reason) => {
                console.log('‚ùå Desconectado:', reason);
                updateServerStatus(false, 'Offline');
            });

            // Sala confirmada
            socket.on('room_joined', (data) => {
                console.log('üîó Sala confirmada:', data.room);
                currentRoom = data.room;
                localStorage.setItem('pairing_code', currentRoom);
            });

            // Novo dispositivo entrou
            socket.on('peer_joined', (data) => {
                console.log('üì± Novo dispositivo conectado:', data.type);
                if (data.type === 'app') {
                    showNotification('App Conectado!', 'success');
                }
            });

            // Dispositivo saiu
            socket.on('peer_left', (data) => {
                console.log('üëã Dispositivo desconectado:', data.type);
            });

            // Status da sess√£o
            socket.on('session_status', (data) => {
                elements.deviceCount.textContent = data.connections;
            });

            // Erro
            socket.on('error', (data) => {
                console.error('[SERVER ERROR]', data.message);
                showNotification(data.message, 'error');
            });

            // Tentativa de reconex√£o
            socket.on('reconnect_attempt', (attempt) => {
                connectionAttempts = attempt;
                updateServerStatus(false, `Reconectando (${attempt}/${MAX_ATTEMPTS})...`);
            });

            // Reconectado
            socket.on('reconnect', () => {
                console.log('üîÑ Reconectado com sucesso');
                updateServerStatus(true, 'Online');
            });
        }

        // GERAR NOVO C√ìDIGO
        function generateNewCode() {
            const code = Math.floor(10000 + Math.random() * 90000).toString();
            currentRoom = code;
            
            localStorage.setItem('pairing_code', code);
            elements.codeNumber.textContent = code;

            // Se j√° estiver conectado, entra na nova sala
            if (socket && socket.connected) {
                socket.emit('join_room', {
                    room: code,
                    type: 'web'
                });
            }

            showNotification('Novo c√≥digo gerado!', 'info');
        }

        // ATUALIZAR STATUS DO SERVIDOR
        function updateServerStatus(isOnline, message) {
            elements.serverStatus.textContent = message;
            
            if (isOnline) {
                elements.serverDot.classList.add('active');
            } else {
                elements.serverDot.classList.remove('active');
            }
        }

        // NOTIFICA√á√ïES
        function showNotification(message, type = 'info') {
            // Cria elemento de notifica√ß√£o
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 30px; right: 30px; z-index: 9999;
                background: rgba(20, 20, 28, 0.95); backdrop-filter: blur(10px);
                border: 1px solid rgba(255,255,255,0.1);
                border-radius: 12px; padding: 15px 20px;
                color: white; font-weight: 600; font-size: 0.9rem;
                box-shadow: 0 10px 40px rgba(0,0,0,0.5);
                animation: slideIn 0.3s ease;
            `;

            const colors = {
                success: '#00ff88',
                error: '#ff2a6d',
                info: '#00f3ff'
            };

            notification.innerHTML = `
                <i class="fa-solid fa-circle" style="color: ${colors[type]}; margin-right: 10px;"></i>
                ${message}
            `;

            document.body.appendChild(notification);

            // Remove ap√≥s 3 segundos
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // CSS para anima√ß√µes de notifica√ß√£o
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(400px); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(400px); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Inicializa quando DOM estiver pronto
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>

</html>
